---
title: "Data Science Jobs"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    logo: ~/AdzunaDataBot/logos/tdlLogo_small.jpg
---

```{r setup, include=FALSE}
library(flexdashboard)
library(RMySQL)
library(leaflet)
library(ggplot2)
library(lubridate)
library(tm)

source("/home/rpopat/AdzunaDataBot/authentications.R")
source("/home/rpopat/AdzunaDataBot/scripts/bow_functions.R")
source("/home/rpopat/AdzunaDataBot/scripts/get_sql_data.R")

duplicate_ads <- which(duplicated(d$id))
d <- d[-duplicate_ads, ]

plot_col <- "darkgreen"

job_points <- data.frame(
  lng = d$longitude, 
  lat = d$latitude
)
gaps <- which(apply(job_points, 1, function(x) any(is.na(x))))
dups <- which(duplicated(job_points))
to_remove <- unique(c(gaps, dups))
d_map <- d[-to_remove,]

words <- BagOfWords(d$description)$word_count
top_words <- words[order(words$count, decreasing = TRUE), ]

d$day_created <- date(d$created)

theme_stripped <- theme(
  panel.background = element_blank(),
  axis.text = element_text(size = 15)
)
```

Inputs {.sidebar}
-----------------------------------------------------------------------

At The Data Lab, we want to stimulate a productive data science environment. Part of this is helping the job market. To keep our fingers on the pulse of data science jobs in the UK we created this little dashboard. We query the [Adzuna](https://developer.adzuna.com/) API every night to retrieve records pertaining to "data science". An EC2 instance achieves this for us. We store this in a MySQL database (also on Amazon). This front end was created in R with [flexdashboard](http://rmarkdown.rstudio.com/flexdashboard/index.html).

If you have any questions about this or anything else we do, please head over to the [website](http://thedatalab.com/) or [get in touch](mailto:info@thedatalab.com) directly.

![powered by Adzuna](/home/rpopat/AdzunaDataBot/logos/adzuna_logo_small.jpg)

Column {data-width=650}
-----------------------------------------------------------------------

### Jobs Map

```{r}
leaflet(d_map) %>%
  addTiles() %>%
  addCircleMarkers(
    color = plot_col,
    popup = paste0(
      d_map$title, " \n Â£",
      d_map$salary_min, " - ", d_map$salary_max
    )
  )
```

Column {data-width=350}
-----------------------------------------------------------------------

### Word Use

```{r}
ggplot(top_words[1:20, ], aes(x = reorder(word, count), y = count)) +
  geom_bar(fill = plot_col, stat = "identity") +
  ylab("") + xlab("") +
  coord_flip() +
  theme_stripped
```

### Posting Rate

```{r}
ggplot(d, aes(x = day_created)) +
  geom_line(stat = "count", color = plot_col, size = 2) +
  theme_stripped
```

